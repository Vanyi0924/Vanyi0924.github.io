import{_ as s,c as n,o as a,a as l}from"./app.19505eb6.js";const C=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u4EC0\u4E48\u662F WalletConnect\uFF1F","slug":"\u4EC0\u4E48\u662F-walletconnect\uFF1F","link":"#\u4EC0\u4E48\u662F-walletconnect\uFF1F","children":[]},{"level":2,"title":"\u5728DApp\u4E2D\u63A5\u5165","slug":"\u5728dapp\u4E2D\u63A5\u5165","link":"#\u5728dapp\u4E2D\u63A5\u5165","children":[]}],"relativePath":"articles/DApp/DApp\u63A5\u5165WalletConnect\u534F\u8BAE.md"}'),o={name:"articles/DApp/DApp\u63A5\u5165WalletConnect\u534F\u8BAE.md"},p=l(`<h2 id="\u4EC0\u4E48\u662F-walletconnect\uFF1F" tabindex="-1">\u4EC0\u4E48\u662F WalletConnect\uFF1F <a class="header-anchor" href="#\u4EC0\u4E48\u662F-walletconnect\uFF1F" aria-hidden="true">#</a></h2><p><a href="https://docs.walletconnect.org/" target="_blank" rel="noreferrer">\u5B98\u65B9\u6587\u6863</a></p><blockquote><p>WalletConnect\u662F\u4E00\u79CD\u5728Wallet\u548C Dapps\uFF08Web3 Apps\uFF09\u4E4B\u95F4\u5B89\u5168\u901A\u4FE1\u7684\u5F00\u653E\u534F\u8BAE\u3002\u8FD9\u4E2A\u534F\u8BAE\u5728\u4E24\u4E2Aapp\u6216\uFF08\u548C\uFF09\u8BBE\u5907\u5EFA\u7ACB\u4E86\u8FDC\u7A0B\u8FDE\u63A5\uFF0C\u901A\u8FC7\u4E00\u4E2A\u6865\u63A5\u670D\u52A1\u5668\uFF08Bridge server\uFF09\u4E2D\u7EE7\u8F7D\u8377\u3002\u8FD9\u4E9B\u6709\u6548\u8D1F\u8F7D\u901A\u8FC7\u4E24\u7AEF\u4E4B\u95F4\u7684\u5171\u4EAB\u5BC6\u94A5\u5BF9\u79F0\u5730\u52A0\u5BC6\u3002</p></blockquote><h2 id="\u5728dapp\u4E2D\u63A5\u5165" tabindex="-1">\u5728DApp\u4E2D\u63A5\u5165 <a class="header-anchor" href="#\u5728dapp\u4E2D\u63A5\u5165" aria-hidden="true">#</a></h2><ol><li>\u5F15\u5165\u76F8\u5173\u4F9D\u8D56 <code>@walletconnect/client</code>\u3001<code>@walletconnect/qrcode-modal</code></li><li>\u521D\u59CB\u5316\u8FDE\u63A5</li><li>\u8BA2\u9605\u4E8B\u4EF6(\u7528\u4E8E\u83B7\u53D6\u7528\u6237\u4FE1\u606F\uFF0C\u8FDE\u63A5\u4FE1\u606F\u7B49)</li><li>\u6839\u636E\u9700\u6C42\u8C03\u7528 <code>connector</code> \u5B9E\u4F8B\u4E0A\u65B9\u6CD5\uFF0C\u5982\u4F7F\u7528<code>connector.sendTransaction</code>\u53D1\u9001\u4EA4\u6613\uFF0C<code>connector.signTransaction</code>\u7B7E\u540D\u4EA4\u6613</li></ol><p><a href="https://docs.walletconnect.org/client-api" target="_blank" rel="noreferrer">walletconnect Api \u6587\u6863</a></p><p>\u6CE8\u610F\uFF1A\u53C2\u6570\u4E2D\u7684 <code>gas</code> \u5B9E\u9645\u4E0A\u6307\u7684\u662F <code>gasLimit</code>\uFF0C\u6240\u4EE5\u4F7F\u7528 <code>gasLimit</code> \u7684\u6570\u503C\u6216\u8005\u76F4\u63A5\u5C06<code>gas</code>\u66FF\u6362\u4E3A <code>gasLimit</code></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre><code><span class="line"><span style="color:#676E95;">// walletconnect \u5BA2\u6237\u7AEF(client)</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> WalletConnect </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@walletconnect/client</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;">// \u4E8C\u7EF4\u7801\u5F39\u7A97(modal)</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> QRCodeModal </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@walletconnect/qrcode-modal</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">initWalletConnect</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">connector</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5EFA\u7ACB\u8FDE\u63A5\u540E walletconnect \u4F1A\u5728localstorage\u4E2D\u7F13\u5B58session\u4FE1\u606F\uFF0Ckey\u4E3A walletconnect</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u6240\u4EE5\u9700\u8981\u4F18\u5148\u68C0\u6D4Bsession\u662F\u5426\u5B58\u5728\uFF0C\u5176\u65AD\u5F00\u4F1A\u81EA\u52A8\u6E05\u9664</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sessionCache</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">localStorage</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getItem</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">walletconnect</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">sessionCache</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">session</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">sessionCache</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">connector</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">WalletConnect</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">session</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">     </span><span style="color:#676E95;">// Create a connector</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">connector</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">WalletConnect</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      bridge</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://bridge.walletconnect.org</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#676E95;">// Required walletconnect\u63D0\u4F9B\u4E86\u56FA\u5B9A\u7684\u6865\u63A5\u670D\u52A1\u5668</span></span>
<span class="line"><span style="color:#F07178;">      qrcodeModal</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">QRCodeModal</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">connector</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">connected</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// create new session</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">connector</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createSession</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u8BA2\u9605\u4E8B\u4EF6</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">subscribeToEvents</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">connector</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">// \u76D1\u542C\u4E8B\u4EF6 payload \u901A\u8FC7\u8F7D\u8377\u83B7\u53D6\u76F8\u5173\u4FE1\u606F</span></span>
<span class="line"><span style="color:#676E95;">// connect, disconnect, session_request, session_update, call_request, wc_sessionRequest, wc_sessionUpdate</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">subscribeToEvents</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">connector</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// Subscribe to connection events</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">connector</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">connect</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">error</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">payload</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">throw</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">error</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// Get provided accounts and chainId</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">accounts</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">chainId</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">payload</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">params</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">connector</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">session_update</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">error</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">payload</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">throw</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">error</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// Get updated accounts and chainId</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">accounts</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">chainId</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">payload</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">params</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">connector</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">disconnect</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">error</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">payload</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">throw</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">error</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// Delete connector</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div>`,8),e=[p];function c(t,r,F,y,D,i){return a(),n("div",null,e)}const d=s(o,[["render",c]]);export{C as __pageData,d as default};
