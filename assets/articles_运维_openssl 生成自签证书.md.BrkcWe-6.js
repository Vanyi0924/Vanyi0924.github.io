import{_ as e,c as a,o as s,a4 as n}from"./chunks/framework.CQUZ9zPN.js";const _=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"articles/运维/openssl 生成自签证书.md","filePath":"articles/运维/openssl 生成自签证书.md"}'),p={name:"articles/运维/openssl 生成自签证书.md"},l=n(`<h2 id="准备工作" tabindex="-1">准备工作 <a class="header-anchor" href="#准备工作" aria-label="Permalink to &quot;准备工作&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>#创建index.txt （database index file）</span></span>
<span class="line"><span>touch /etc/pki/CA/index.txt</span></span>
<span class="line"><span>#创建新证书编号为01，往下依次类推，为十六进制 （The current serial number）</span></span>
<span class="line"><span>touch /etc/pki/CA/serial </span></span>
<span class="line"><span>#用于吊销证书</span></span>
<span class="line"><span>touch /etc/pki/CA/crlnumber</span></span></code></pre></div><h2 id="创建ca自签证书" tabindex="-1">创建CA自签证书 <a class="header-anchor" href="#创建ca自签证书" aria-label="Permalink to &quot;创建CA自签证书&quot;">​</a></h2><ol><li><p>生成私钥 <code>openssl genrsa -out /etc/pki/CA/private/cakey.pem</code></p></li><li><p>生成自签文件10年 <code>openssl req -new -x509 -key /etc/pki/CA/private/cakey.pem -out /etc/pki/CA/cacert.pem -days 3650 </code></p></li><li><p>查看生成的自签证书 <code>openssl x509 -in /etc/pki/CA/cacert.pem -noout -text</code></p></li></ol><h2 id="生成客户端证书" tabindex="-1">生成客户端证书 <a class="header-anchor" href="#生成客户端证书" aria-label="Permalink to &quot;生成客户端证书&quot;">​</a></h2><ol><li><p>生成私钥 <code>openssl genrsa -out client.key</code></p></li><li><p>生成请求文件 <code>openssl req -new -key client.key -out client.csr -days 365</code></p></li><li><p>使用CA签发客户端证书(会使用默认配置) <code>openssl ca -in client.csr -out client.crt -days 365</code></p></li><li><p>生成浏览器证书 <code>openssl pkcs12 -export -clcerts -in client.crt -inkey client.key -out client.p12</code></p></li></ol><h2 id="吊销证书" tabindex="-1">吊销证书 <a class="header-anchor" href="#吊销证书" aria-label="Permalink to &quot;吊销证书&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 吊销证书序列号</span></span>
<span class="line"><span>echo 01 &gt;/etc/pki/CA/crlnumber</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 吊销</span></span>
<span class="line"><span>openssl ca -revoke 证书名</span></span>
<span class="line"><span># or</span></span>
<span class="line"><span>openssl ca -revoke /etc/pki/CA/newcerts/对应证书序列号.pem</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 重新写入吊销列表文件</span></span>
<span class="line"><span>openssl ca -gencrl -out /etc/pki/CA/crl/crl.pem</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 查看吊销证书情况</span></span>
<span class="line"><span>openssl crl -in /etc/pki/CA/crl/crl.pem -noout -text</span></span>
<span class="line"><span># or</span></span>
<span class="line"><span>cat /etc/pki/CA/index.txt</span></span></code></pre></div><h2 id="术语" tabindex="-1">术语 <a class="header-anchor" href="#术语" aria-label="Permalink to &quot;术语&quot;">​</a></h2><ul><li><p>RSA私钥能解密用证书公钥加密后的信息。通常以.key为后缀，表示私钥也称作密钥。是需要管理员小心保管，不能泄露的。</p></li><li><p>CSR(Certificate Signing Request)包含了公钥和名字信息。通常以.csr为后缀，是网站向CA发起认证请求的文件，是中间文件。</p></li><li><p>证书通常以.crt为后缀，表示证书文件。</p></li><li><p>CA(Certifying Authority)表示证书权威机构，它的职责是证明公钥属于个人、公司或其他的组织。</p></li></ul><h3 id="openssl命令详解" tabindex="-1"><a href="https://juejin.cn/post/6844903989469773832" target="_blank" rel="noreferrer">OpenSSL命令详解</a> <a class="header-anchor" href="#openssl命令详解" aria-label="Permalink to &quot;[OpenSSL命令详解](https://juejin.cn/post/6844903989469773832)&quot;">​</a></h3><p>备忘：</p><ul><li><code>nginx</code>需要配置 <code>ssl_crl /etc/pki/CA/crl/crl.pem;</code> 吊销证书列表文件，更新后重启<code>nginx</code></li><li>存储目录 <code>/etc/pki/CA/</code> 可在配置文件里设置</li><li>默认配置文件 <code>/etc/pki/CA/openssl.cnf</code></li><li>openssl 升级新版本 <a href="https://blog.51cto.com/net881004/2116848" target="_blank" rel="noreferrer">https://blog.51cto.com/net881004/2116848</a></li></ul>`,13),t=[l];function c(i,o,r,d,h,u){return s(),a("div",null,t)}const m=e(p,[["render",c]]);export{_ as __pageData,m as default};
